---
종류: "문헌"
날짜: "2023-09-03"
인물_저자: "윤성우"
태그: "프로그래밍,네트워크"
출처: "윤성우의 열혈 TCP IP 소켓 프로그래밍"
구분_장소_분류: ""
Alias: "" # 한글/영어
---

### 날짜: 2023-09-03 17:19
### 태그: #프로그래밍/네트워크

>[!메모]
> 

### 학습 내용
---
## TCP 기반의 half-close
### 일방적인 연결 종료의 문제
- 한쪽으로의 데이터 수신이 끝나면 close를 호출하기 때문에 소켓이 닫혀버림
- 상호간 데이터 수신과 관련된 함수의 호출 자체가 불가능해진다.
### 소켓과 스트림
- 두 호스트가 소켓으로 연결이 된 상태를 **스트림이 형성된 상태**라 한다.
- 각 호스트 별로 입력과 출력 스트림이 형성된다. 
	- 각 호스트의 출력 스트림은 상대방의 입력 스트림으로 이어진다.
	- close는 두 스트림을 모두 끊어버린다.
	- shutdown을 통해 한 쪽 스트림만 끊어서 수신만 가능하도록 한다.
		- half-close
### 우아한 종료를 위한 shutdown()
- 함수 시그니쳐
```c++
#include <sys/socket.h>

int shutdown(int sock, int howto);
```
- sock: 종료할 소켓의 파일 디스크립터
- howto: 종료 방법에 대한 정보 전달
	- SHUT_RD: 입력 스트림 종료
		- 데이터가 입력 버퍼에 전달이 되더라도 내용이 버려짐.
		- 입력 관련 함수 호출 불가.
	- SHUT_WR: 출력 스트림 종료
		- 출력 스트림이 종료되어 데이터 전송 불가능.
		- **출력 스트림에 남아있던 데이터는 목적지로 전송**됨.
	- SHUT_RDWR: 입출력 스트림 종료
		- 입출력 스트림 모두 종료
### Half-close의 필요성
- 파일을 전송하는 서버는 데이터를 계속 전달
	- 클라이언트 측에서는 언제까지 데이터를 수신해야 하는지 알 수 없음.
	- receive가 계속 호출이 된다면 블록 상태에 빠져버릴 수 있다.
- 데이터를 모두 전달했을 때 EOF를 전달하려면 어떻게 해야하는가?
	- **출력 스트림을 종료**하면 상대 호스트로 EOF가 전송됨.
- 데이터를 모두 전달한 뒤 상대 호스트에게 전송 완료 메시지를 전송하려는 상황이라면?
	- 이미 클라이언트 측에서 모든 데이터를 받았다는 것을 알리려면 EOF를 주는 수밖에 없다.
	- EOF를 전달하기 위해 소켓을 닫아버리면 통신 자체가 불가능해진다.
- shutdown(clientSocket, **SHUT_RD**)을 통해 EOF를 전달한다.
	- 출력 스트림은 살아있기 때문에 후속 데이터를 전송할 수 있다.

---
### 생각 (파생된 질문/생각)
- 
### 출 처
- 윤성우의 열혈 TCP IP 소켓 프로그래밍

### 연결 문서: {연결 이유}
- 